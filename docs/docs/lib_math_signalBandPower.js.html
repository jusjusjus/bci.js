<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>lib/math/signalBandPower.js - Documentation</title>

    <link rel='shortcut icon' type='image/x-icon' href='/img/favicon.ico' />

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <style>
        li > code {
            min-height: 1em;
        }
    </style>
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="module-bcijs.oscStream.html">oscStream</a><ul class='methods'><li data-type='method'><a href="module-bcijs.oscStream.html#on">on</a></li><li data-type='method'><a href="module-bcijs.oscStream.html#start">start</a></li><li data-type='method'><a href="module-bcijs.oscStream.html#stop">stop</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-bcijs.html">bcijs</a><ul class='methods'><li data-type='method'><a href="module-bcijs.html#.accuracy">accuracy</a></li><li data-type='method'><a href="module-bcijs.html#.averageBandPowers">averageBandPowers</a></li><li data-type='method'><a href="module-bcijs.html#.balancedAccuracy">balancedAccuracy</a></li><li data-type='method'><a href="module-bcijs.html#.confusionMatrix">confusionMatrix</a></li><li data-type='method'><a href="module-bcijs.html#.cspLearn">cspLearn</a></li><li data-type='method'><a href="module-bcijs.html#.cspProject">cspProject</a></li><li data-type='method'><a href="module-bcijs.html#.f1">f1</a></li><li data-type='method'><a href="module-bcijs.html#.fastICA">fastICA</a></li><li data-type='method'><a href="module-bcijs.html#.generateSignal">generateSignal</a></li><li data-type='method'><a href="module-bcijs.html#.ldaClassify">ldaClassify</a></li><li data-type='method'><a href="module-bcijs.html#.ldaLearn">ldaLearn</a></li><li data-type='method'><a href="module-bcijs.html#.ldaProject">ldaProject</a></li><li data-type='method'><a href="module-bcijs.html#.loadCSV">loadCSV</a></li><li data-type='method'><a href="module-bcijs.html#.loadEDF">loadEDF</a></li><li data-type='method'><a href="module-bcijs.html#.mcc">mcc</a></li><li data-type='method'><a href="module-bcijs.html#.nextpow2">nextpow2</a></li><li data-type='method'><a href="module-bcijs.html#.oscCollect">oscCollect</a></li><li data-type='method'><a href="module-bcijs.html#.oscHeaderScan">oscHeaderScan</a></li><li data-type='method'><a href="module-bcijs.html#.partition">partition</a></li><li data-type='method'><a href="module-bcijs.html#.precision">precision</a></li><li data-type='method'><a href="module-bcijs.html#.prompt">prompt</a></li><li data-type='method'><a href="module-bcijs.html#.psd">psd</a></li><li data-type='method'><a href="module-bcijs.html#.psdBandPower">psdBandPower</a></li><li data-type='method'><a href="module-bcijs.html#.recall">recall</a></li><li data-type='method'><a href="module-bcijs.html#.round">round</a></li><li data-type='method'><a href="module-bcijs.html#.saveCSV">saveCSV</a></li><li data-type='method'><a href="module-bcijs.html#.signalBandPower">signalBandPower</a></li><li data-type='method'><a href="module-bcijs.html#.specificity">specificity</a></li><li data-type='method'><a href="module-bcijs.html#.subscript">subscript</a></li><li data-type='method'><a href="module-bcijs.html#.toFixed">toFixed</a></li><li data-type='method'><a href="module-bcijs.html#.toTable">toTable</a></li><li data-type='method'><a href="module-bcijs.html#.transpose">transpose</a></li><li data-type='method'><a href="module-bcijs.html#.wait">wait</a></li><li data-type='method'><a href="module-bcijs.html#.windowApply">windowApply</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="module-bcijs.features.html">features</a><ul class='methods'><li data-type='method'><a href="module-bcijs.features.html#.logvar">logvar</a></li><li data-type='method'><a href="module-bcijs.features.html#.rootMeanSquare">rootMeanSquare</a></li><li data-type='method'><a href="module-bcijs.features.html#.variance">variance</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">lib/math/signalBandPower.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const psd = require('./psd.js');
const psdBandPower = require('./psdBandPower.js');
const nextpow2 = require('./nextpow2.js');
const transpose = require('./transpose.js');

/**
 * Compute the average power across a given frequency band in a signal.
 * @memberof module:bcijs
 * @param {number[]|number[][]} samples - The signal (array of numbers) or a matrix of signals, where rows are samples and columns are signals.
 * @param {number} sampleRate - The sample rate of the signal.
 * @param {(Array|string)} bands - The frequency band or array of bands, where a single band is provided as an array [frequencyStart, frequencyStop] or a string &lt;code>delta&lt;/code> (1-3 Hz), &lt;code>theta&lt;/code> (4-7 Hz), &lt;code>alpha&lt;/code> (8-12 Hz), &lt;code>beta&lt;/code> (13-30 Hz), or &lt;code>gamma&lt;/code> (31-50 Hz).&lt;br>
 * While string representations allow for easier prototyping, the use of a specific band passed as an array is
 * recommended, as band string representations may change in future updates.
 * @param {number} [fftSize=Math.pow(2, bci.nextpow2(signal.length))] - Size of the fourier transform used to compute the PSD.
 * @returns {number} The average power in the frequency band.
 * @example
 * // Example outputs are rounded
 * 
 * // Single signal examples
 * let sampleRate = 512;
 * let signal = bci.generateSignal([2,16], [10,20], sampleRate, 1);
 * // Get a single power in one band
 * console.log(bci.signalBandPower(signal, sampleRate, 'alpha')); // returns 102.4
 * // Specify a custom band as an array (Ex: 8 Hz - 12 Hz)
 * console.log(bci.signalBandPower(signal, sampleRate, [8, 12])); // returns 102.4
 * // Obtain multiple band powers
 * console.log(bci.signalBandPower(signal, sampleRate, ['alpha', 'beta'])); // returns [ 102.4, 227.6 ]
 * // Multiple band powers works with custom bands too
 * console.log(bci.signalBandPower(signal, sampleRate, [[8, 12], [13, 30]])); // returns [ 102.4, 227.6 ]
 * 
 * // Works with multiple signals too (example with 2 signals)
 * let signal2 = bci.generateSignal([16, 2], [10, 20], 512, 1);
 * let samples = bci.transpose([signal, signal2]);
 * console.log(bci.signalBandPower(samples, sampleRate, 'alpha'));
 * // Returns an array containing the alpha value for each signal
 * console.log(bci.signalBandPower(samples, sampleRate, ['alpha', 'beta', 'gamma']));
 * // Returns a 2d array with number_of_bands rows and number_of_signals columns
 */
function signalBandPower(samples, sampleRate, bands, fftSize = null) {
	if(fftSize === null){
		fftSize = Math.pow(2, nextpow2(samples.length));
	}

	function getSignalPower(signal, band){
		let p = psd(signal, {fftSize: fftSize});
		return psdBandPower(p, sampleRate, band, fftSize);
	}

	// Store if bands was passed as just a string or frequency range (not an array of bands)
	let notBandArray = typeof bands === 'string' || (!Array.isArray(bands[0]) &amp;&amp; typeof(bands[0]) !== 'string');

	// Now convert it to an array of bands so the matrix operations will work
	if(notBandArray) bands = [bands];

	// Store the resulting matrix or array of powers
	let result;

	// If samples is a matrix (multiple signals)
	if(Array.isArray(samples[0])){
		let num_signals = samples[0].length;
		let channels = transpose(samples);

		result = new Array(bands.length);

		for(let r = 0; r &lt; bands.length; r++) {
			result[r] = new Array(num_signals);
			for(let c = 0; c &lt; num_signals; c++) {
				result[r][c] = getSignalPower(channels[c], bands[r]);
			}
		}
	} else {
		// Else, must be single signal as row vector (1d array)
		result = new Array(bands.length);
		for(let i = 0; i &lt; bands.length; i++) {
			result[i] = getSignalPower(samples, bands[i]);
		}
	}
	
	// If bands wasn't an array of bands, return the 1d array of results for that band
	if(notBandArray) return result[0];

	// If bands was multiple bands, return the result as a matrix
	return result;
}

module.exports = signalBandPower;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Mar 15 2019 03:01:09 GMT-0400 (Eastern Daylight Time) using a modified version of the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
